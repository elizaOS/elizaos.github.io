{
  "interval": {
    "intervalStart": "2025-06-23T00:00:00.000Z",
    "intervalEnd": "2025-06-24T00:00:00.000Z",
    "intervalType": "day"
  },
  "repository": "elizaos-plugins/plugin-knowledge",
  "overview": "From 2025-06-23 to 2025-06-24, elizaos-plugins/plugin-knowledge had 1 new PRs (0 merged), 1 new issues, and 4 active contributors.",
  "topIssues": [
    {
      "id": "I_kwDOOu4gVs680dM0",
      "title": "When CTX_KNOWLEDGE_ENABLED=true fails to process documents - ZodError",
      "author": "gnomonprime",
      "number": 26,
      "repository": "elizaos-plugins/plugin-knowledge",
      "body": "# Knowledge Plugin Error: AI_InvalidPromptError when CTX_KNOWLEDGE_ENABLED=true\n\n## Bug Description\n\nWhen enabling the knowledge plugin with `CTX_KNOWLEDGE_ENABLED=true`, the system fails to process documents during startup with the following error:\n\n```\nAI_InvalidPromptError: Invalid prompt: message must be a CoreMessage or a UI message\nValidation error: Type validation failed: Value: [{\"role\":\"system\",\"content\":[{\"type\":\"text\",\"text\":\"...\"}]}]\n```\n\n## Error Details\n\n**Stack Trace:**\n```\nError message: [\n  {\n    \"code\": \"invalid_union\",\n    \"unionErrors\": [\n      {\n        \"issues\": [\n          {\n            \"code\": \"invalid_type\",\n            \"expected\": \"string\",\n            \"received\": \"array\",\n            \"path\": [0, \"content\"],\n            \"message\": \"Expected string, received array\"\n          }\n        ]\n      },\n      {\n        \"issues\": [\n          {\n            \"received\": \"system\",\n            \"code\": \"invalid_literal\",\n            \"expected\": \"user\",\n            \"path\": [0, \"role\"],\n            \"message\": \"Invalid literal value, expected \\\"user\\\"\"\n          }\n        ]\n      }\n    ]\n  }\n]\n    at standardizePrompt (file:///home/gnomon/elizaos/node_modules/ai/dist/index.mjs:2139:13)\n    at generateText (file:///home/gnomon/elizaos/node_modules/ai/dist/index.mjs:4164:25)\n    at generateClaudeWithCaching (file:///home/gnomon/elizaos/node_modules/@elizaos/plugin-knowledge/dist/index.js:890:24)\n    at generateOpenRouterText (file:///home/gnomon/elizaos/node_modules/@elizaos/plugin-knowledge/dist/index.js:811:20)\n    at generateText (file:///home/gnomon/elizaos/node_modules/@elizaos/plugin-knowledge/dist/index.js:708:22)\n    at generateTextOperation (file:///home/gnomon/elizaos/node_modules/@elizaos/plugin-knowledge/dist/index.js:1340:28)\n    at withRateLimitRetry (file:///home/gnomon/elizaos/node_modules/@elizaos/plugin-knowledge/dist/index.js:1476:18)\n    at processAndSaveFragments (file:///home/gnomon/elizaos/node_modules/@elizaos/plugin-knowledge/dist/index.js:1163:34)\n```\n\n## Environment\n\n- **ElizaOS Version**: `v1.0.11`\n- **Knowledge Plugin Version**: `@elizaos/plugin-knowledge@1.0.7`\n- **Node.js Version**: `v23.3.0`\n- **OS**: `WSL2 Ubuntu (linux 6.6.87.2-microsoft-standard-WSL2)`\n- **AI SDK Version**: `4.3.16`\n\n## Configuration\n\n**Character Configuration (test.json):**\n```json\n{\n  \"name\": \"Eliza\",\n  \"plugins\": [\n    \"@elizaos/plugin-sql\",\n    \"@elizaos/plugin-openrouter\",\n    \"@elizaos/plugin-openai\",\n    \"@elizaos/plugin-twitter\",\n    \"@elizaos/plugin-knowledge\",\n    \"@elizaos/plugin-bootstrap\"\n  ],\n  \"knowledge\": [\n    {\n      \"path\": \"docs/README.md\",\n      \"shared\": false\n    }\n  ]\n}\n```\n\n**Environment Variable:**\n```\n# Knowledge Plugin Configuration\nLOAD_DOCS_ON_STARTUP=true\n# Advanced Configuration\nCTX_KNOWLEDGE_ENABLED=true\nEMBEDDING_PROVIDER=openai\nTEXT_EMBEDDING_MODEL=text-embedding-3-small\nEMBEDDING_DIMENSION=1536\nTEXT_PROVIDER=openrouter\nTEXT_MODEL=anthropic/claude-sonnet-4\nMAX_CONCURRENT_REQUESTS=30         # Parallel processing limit\nREQUESTS_PER_MINUTE=60             # Rate limiting\nTOKENS_PER_MINUTE=150000           # Token rate limiting\nMAX_INPUT_TOKENS=4000              # Chunk size limit\nMAX_OUTPUT_TOKENS=4096             # Response size limit\n```\n\n## Expected Behavior\n\nThe knowledge plugin should successfully:\n1. Process documents from the `knowledge` array in the character configuration\n2. Generate contextualized chunks without errors\n3. Create document fragments in the knowledge base\n\n## Actual Behavior\n\n- Knowledge service fails to process any document chunks\n- All chunks (2/2 in this case) fail processing\n- Document processing completes with 0 fragments created\n- System logs show: `Failed to process 2 chunks out of 2 for document`\n\n## Analysis\n\nThe error appears to be related to:\n\n1. **Invalid Message Format**: The knowledge plugin is constructing prompts with:\n   - `role: \"system\"` (should be \"user\", \"assistant\", or \"tool\")\n   - `content` as an array instead of a string\n   \n2. **AI SDK Compatibility**: The prompt format doesn't match the expected `CoreMessage` or `UIMessage` schema\n\n3. **Version Mismatch**: Potential incompatibility between `@elizaos/plugin-knowledge@1.0.7` and the current AI SDK version\n\n## Proposed Solutions\n\n1. **Update Knowledge Plugin**: Check if a newer version of `@elizaos/plugin-knowledge` is available that's compatible with the current AI SDK\n2. **Fix Prompt Construction**: Update the knowledge plugin to construct prompts in the correct format\n3. **Add Validation**: Implement proper validation of prompt structure before passing to AI SDK\n\n## Workaround\n\nCurrently, setting `CTX_KNOWLEDGE_ENABLED=false` allows the system to start normally, but without knowledge processing capabilities.\n\n## Additional Context\n\nThis error occurs during the document contextualization phase where the knowledge service attempts to generate enriched chunks using AI models. The error suggests that the prompt being passed to the `generateText` function doesn't conform to the expected message schema.\n\nThe specific validation errors indicate:\n- Content should be a string, not an array\n- Role should be \"user\", \"assistant\", or \"tool\", not \"system\"\n- Missing required fields for tool messages\n\n## Reproduction Steps\n\n1. Create a character configuration with `@elizaos/plugin-knowledge` in plugins array\n2. Add knowledge documents to the character configuration\n3. Set `CTX_KNOWLEDGE_ENABLED=true` in environment\n4. Start the ElizaOS agent (LOG_LEVEL=debug elizaos start --character test.json )\n5. Observe the error during document processing\n\n## Related Issues\n\nThis appears to be related to the AI SDK prompt validation changes mentioned in:\n- [Vercel AI SDK Discussion #5833](https://github.com/vercel/ai/discussions/5833)\n- AI SDK error documentation for `AI_InvalidPromptError`",
      "createdAt": "2025-06-23T11:39:05Z",
      "closedAt": null,
      "state": "OPEN",
      "commentCount": 1
    }
  ],
  "topPRs": [
    {
      "id": "PR_kwDOOu4gVs6bvG_I",
      "title": "feat: deterministic ids to prevent duplicates",
      "author": "0xbbjoker",
      "number": 27,
      "body": "Impl deterministic ids to prevent duplicates. \n\n<!-- This is an auto-generated comment: release notes by coderabbit.ai -->\n## Summary by CodeRabbit\n\n- **New Features**\n  - The system now generates unique document and knowledge item IDs based on content, agent ID, and optional metadata, improving consistency and deduplication.\n  - Added option to fetch only documents without fragments in knowledge queries.\n  - Knowledge graph nodes display fragment counts for clearer insights.\n- **Refactor**\n  - Removed client-side generation of document IDs; IDs are now created by the service using a content-based approach.\n  - Enhanced knowledge chunk retrieval logic to support multiple modes and detailed metadata.\n  - Refined knowledge tab and graph UI to better distinguish between viewing all documents and individual document fragments.\n- **Chores**\n  - Updated package version to 1.0.9.\n<!-- end of auto-generated comment: release notes by coderabbit.ai -->",
      "repository": "elizaos-plugins/plugin-knowledge",
      "createdAt": "2025-06-23T21:17:02Z",
      "mergedAt": "2025-06-24T10:12:29Z",
      "additions": 394,
      "deletions": 209
    }
  ],
  "codeChanges": {
    "additions": 0,
    "deletions": 0,
    "files": 0,
    "commitCount": 1
  },
  "completedItems": [],
  "topContributors": [
    {
      "username": "yungalgo",
      "avatarUrl": "https://avatars.githubusercontent.com/u/113615973?u=92e0f29f7e2fbb8ce46ed13c51f692ca803de02d&v=4",
      "totalScore": 89.47350881969787,
      "prScore": 89.03550881969787,
      "issueScore": 0,
      "reviewScore": 0,
      "commentScore": 0.43799999999999994,
      "summary": "yungalgo: Merged 2 PRs, including a significant refactor in #5246 (+6421/-2262 lines) and a fix in #5245 (+0/-0 lines), while modifying 16 files with a total of +634/-454 lines across 11 commits. Maintained a consistent work pattern, focusing primarily on other work (64%) and tests (18%)."
    },
    {
      "username": "wtfsayo",
      "avatarUrl": "https://avatars.githubusercontent.com/u/82053242?u=98209a1f10456f42d4d2fa71db4d5bf4a672cbc3&v=4",
      "totalScore": 58.793537711942804,
      "prScore": 49.3555377119428,
      "issueScore": 0,
      "reviewScore": 9,
      "commentScore": 0.43799999999999994,
      "summary": "wtfsayo: Merged 1 PR (#5250) focused on fixing macOS CLI test failures, contributing a significant change of +10012/-5616 lines. Actively engaged in the codebase with 21 commits, modifying 165 files primarily for bugfix work (38%) and other improvements (38%)."
    },
    {
      "username": "Samarthsinghal28",
      "avatarUrl": "https://avatars.githubusercontent.com/u/120447590?v=4",
      "totalScore": 53.7557738965761,
      "prScore": 53.7557738965761,
      "issueScore": 0,
      "reviewScore": 0,
      "commentScore": 0,
      "summary": "Samarthsinghal28: Merged 1 significant pull request (#5247) with substantial changes of +13013/-2938 lines, demonstrating sporadic activity today. The average complexity of merged PRs reflects a consistent effort, with an average of +10193/-118 lines and a 22-hour merge time."
    },
    {
      "username": "0xbbjoker",
      "avatarUrl": "https://avatars.githubusercontent.com/u/54844437?u=90fe1762420de6ad493a1c1582f1f70c0d87d8e2&v=4",
      "totalScore": 51.88408389070667,
      "prScore": 51.68408389070667,
      "issueScore": 0,
      "reviewScore": 0,
      "commentScore": 0.2,
      "summary": null
    },
    {
      "username": "Dexploarer",
      "avatarUrl": "https://avatars.githubusercontent.com/u/211557447?u=21a243d61cc1f87574328ae07fc64d7d7577b53d&v=4",
      "totalScore": 43.5437738965761,
      "prScore": 43.5437738965761,
      "issueScore": 0,
      "reviewScore": 0,
      "commentScore": 0,
      "summary": "Dexploarer: Opened 1 PR (#5243) titled \"Random Fixes\" and made significant code changes by modifying 67 files (+1479/-9894 lines) with a primary focus on feature work (83%). Maintained a consistent activity pattern with 12 commits today."
    },
    {
      "username": "tcm390",
      "avatarUrl": "https://avatars.githubusercontent.com/u/60634884?u=c6c41679b8322eaa0c81f72e0b4ed95e80f0ac16&v=4",
      "totalScore": 20.684306144334055,
      "prScore": 20.684306144334055,
      "issueScore": 0,
      "reviewScore": 0,
      "commentScore": 0,
      "summary": "tcm390: Merged 1 PR (#5248) focused on adding background color to dialog content, resulting in significant code changes of +5415/-561 lines across 63 modified files. Maintained a consistent activity pattern with 2 commits today."
    },
    {
      "username": "ChristopherTrimboli",
      "avatarUrl": "https://avatars.githubusercontent.com/u/27584221?u=0d816ce1dcdea8f925aba18bb710153d4a87a719&v=4",
      "totalScore": 15,
      "prScore": 0,
      "issueScore": 0,
      "reviewScore": 15,
      "commentScore": 0,
      "summary": "ChristopherTrimboli: Made significant bugfix contributions by modifying 3 files (+568/-402 lines) with 1 commit, while also providing 3 approvals in code reviews. Maintained a consistent activity pattern, being active every day."
    },
    {
      "username": "urosognjenovic",
      "avatarUrl": "https://avatars.githubusercontent.com/u/104977001?u=cc6ab68172579c80128af1f8d5b5d173dfe63a91&v=4",
      "totalScore": 4,
      "prScore": 0,
      "issueScore": 4,
      "reviewScore": 0,
      "commentScore": 0,
      "summary": "urosognjenovic: Created 1 issue today (#5249 \"Issues setting up a project with desired provider and overall...\" (OPEN)), showing sporadic activity with no other contributions."
    },
    {
      "username": "kamalbuilds",
      "avatarUrl": "https://avatars.githubusercontent.com/u/95926324?u=eae3fbc4228c17bb52c31b08da2d5f71fb2345db&v=4",
      "totalScore": 2.3000000000000003,
      "prScore": 0,
      "issueScore": 2.1,
      "reviewScore": 0,
      "commentScore": 0.2,
      "summary": "kamalbuilds: Created 1 issue (#5244 \"Deploy Eliza agents\") and commented on another issue, showing sporadic activity today."
    },
    {
      "username": "gnomonprime",
      "avatarUrl": "https://avatars.githubusercontent.com/u/213946859?v=4",
      "totalScore": 2,
      "prScore": 0,
      "issueScore": 2,
      "reviewScore": 0,
      "commentScore": 0,
      "summary": null
    }
  ],
  "newPRs": 1,
  "mergedPRs": 0,
  "newIssues": 1,
  "closedIssues": 0,
  "activeContributors": 4
}